class BlogSearch{constructor(t={}){this.searchInput=t.searchInput||"#blog-search-input",this.resultsContainer=t.resultsContainer||"#blog-search-results",this.loadingContainer=t.loadingContainer||"#blog-search-loading",this.postsContainer=t.postsContainer||".post-list",this.paginationContainer=t.paginationContainer||".pagination",this.searchJsonPath=t.searchJsonPath||"/search_data.json",this.noResultsText=t.noResultsText||"No results found",this.limit=t.limit||50,this.posts=[],this.searchActive=!1;const e=document.querySelector("base");if(this.baseUrl=e?e.getAttribute("href"):"",!this.baseUrl){const t=window.location.pathname.split("/");t.length>1&&""!==t[1]&&(this.baseUrl="/"+t[1])}this.init()}async init(){if(this.searchInputElement=document.querySelector(this.searchInput),this.resultsContainerElement=document.querySelector(this.resultsContainer),this.loadingElement=document.querySelector(this.loadingContainer),this.postsContainerElement=document.querySelector(this.postsContainer),this.paginationElement=document.querySelector(this.paginationContainer),this.searchInputElement&&this.resultsContainerElement){this.originalPosts=this.postsContainerElement?this.postsContainerElement.innerHTML:"",this.originalPagination=this.paginationElement?this.paginationElement.innerHTML:"";try{const t=window.location.origin+(this.baseUrl||"")+this.searchJsonPath,e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch search data: ${e.status} ${e.statusText}`);this.posts=await e.json(),this.posts.length}catch(t){return void(this.loadingElement&&(this.loadingElement.innerHTML=`<div class="alert alert-danger">Failed to load search data: ${t.message}</div>`,this.loadingElement.style.display="block"))}this.bindEvents()}}bindEvents(){this.searchInputElement.addEventListener("input",this.debounce((()=>{const t=this.searchInputElement.value.trim();t.length>=2?this.search(t):this.searchActive&&this.resetSearch()}),300));const t=document.querySelector("#blog-search-clear");t&&t.addEventListener("click",(()=>{this.searchInputElement.value="",this.resetSearch()}));const e=document.querySelector("#blog-search-submit");e&&e.addEventListener("click",(()=>{const t=this.searchInputElement.value.trim();t.length>=2&&this.search(t)})),this.searchInputElement.addEventListener("keydown",(t=>{if("Enter"===t.key){const t=this.searchInputElement.value.trim();t.length>=2&&this.search(t)}}))}search(t){this.searchActive=!0,this.loadingElement&&(this.loadingElement.style.display="block"),this.paginationElement&&(this.paginationElement.style.display="none"),this.postsContainerElement&&(this.postsContainerElement.style.display="none"),setTimeout((()=>{const e=this.getResults(t);this.loadingElement&&(this.loadingElement.style.display="none"),0===e.length?(this.resultsContainerElement.innerHTML=`<p class="search-no-results">${this.noResultsText}</p>`,this.resultsContainerElement.style.display="block"):(this.renderResults(e,t),this.resultsContainerElement.style.display="block")}),300)}getResults(t){const e=(t=t.toLowerCase()).split(" ").filter((t=>t.length>0));return this.posts.filter((s=>{const n=s.title?.toLowerCase().includes(t)||!1,i=s.content?.toLowerCase().includes(t)||!1,a=!!s.description&&s.description.toLowerCase().includes(t),l=!!(s.tags&&s.tags.length>0)&&s.tags.some((e=>e?.toLowerCase().includes(t))),o=!!(s.categories&&s.categories.length>0)&&s.categories.some((e=>e?.toLowerCase().includes(t)));if(e.length>1){const t=e.every((t=>s.title&&s.title.toLowerCase().includes(t)||s.content&&s.content.toLowerCase().includes(t)||!!s.description&&s.description.toLowerCase().includes(t)||!!(s.tags&&s.tags.length>0)&&s.tags.some((e=>e?.toLowerCase().includes(t)))||!!(s.categories&&s.categories.length>0)&&s.categories.some((e=>e?.toLowerCase().includes(t)))));return n||i||a||l||o||t}return n||i||a||l||o})).sort(((t,e)=>{const s=new Date(t.date);return new Date(e.date)-s})).slice(0,this.limit)}highlightText(t,e){if(!t)return"";const s=e.toLowerCase().split(" ").filter((t=>t.length>0));if(0===s.length)return t;try{let e=t;const n=new RegExp(`(${s.map((t=>this.escapeRegExp(t))).join("|")})`,"gi");return e=e.replace(n,'<span class="search-highlight">$1</span>'),e}catch(e){return t}}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}renderResults(t,e){try{let s='<ul class="post-list">';t.forEach((t=>{const n=new Date(t.date),i=n.getFullYear(),a=n.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),l=this.highlightText(t.title,e),o=this.highlightText(t.description,e);s+="<li>",t.thumbnail&&(s+='<div class="row"><div class="col-sm-9">'),s+=`\n          <h3>\n            <a class="post-title" href="${this.baseUrl}${t.url}">${l}</a>\n          </h3>\n          <p>${o||""}</p>\n          <p class="post-meta">\n            ${t.readtime||"3"} min read &nbsp; &middot; &nbsp;\n            ${a}\n            ${t.external_source?`&nbsp; &middot; &nbsp; ${t.external_source}`:""}\n          </p>\n          <p class="post-tags">\n            <a href="${this.baseUrl}/blog/${i}/">\n              <i class="fa-solid fa-calendar fa-sm"></i> ${i} </a>\n        `,t.tags&&t.tags.length>0&&(s+="&nbsp; &middot; &nbsp;",t.tags.forEach(((n,i)=>{if(n){const a=this.highlightText(n,e);s+=`\n                <a href="${this.baseUrl}/blog/tag/${this.slugify(n)}/">\n                  <i class="fa-solid fa-hashtag fa-sm"></i> ${a}</a>\n              `,i<t.tags.length-1&&(s+="&nbsp;")}}))),t.categories&&t.categories.length>0&&(s+="&nbsp; &middot; &nbsp;",t.categories.forEach(((n,i)=>{if(n){const a=this.highlightText(n,e);s+=`\n                <a href="${this.baseUrl}/blog/category/${this.slugify(n)}/">\n                  <i class="fa-solid fa-tag fa-sm"></i> ${a}</a>\n              `,i<t.categories.length-1&&(s+="&nbsp;")}}))),s+="</p>",t.thumbnail&&(s+=`\n            </div>\n            <div class="col-sm-3">\n              <img class="card-img" src="${this.baseUrl}${t.thumbnail}" style="object-fit: cover; height: 90%" alt="image">\n            </div>\n          </div>\n          `),s+="</li>"})),s+="</ul>",this.resultsContainerElement.innerHTML=s}catch(t){this.resultsContainerElement.innerHTML=`<p class="search-no-results">Error rendering results: ${t.message}</p>`}}resetSearch(){this.searchActive=!1,this.loadingElement&&(this.loadingElement.style.display="none"),this.resultsContainerElement.style.display="none",this.resultsContainerElement.innerHTML="",this.postsContainerElement&&(this.postsContainerElement.style.display="block",this.originalPosts&&(this.postsContainerElement.innerHTML=this.originalPosts)),this.paginationElement&&(this.paginationElement.style.display="block",this.originalPagination&&(this.paginationElement.innerHTML=this.originalPagination))}debounce(t,e){let s;return function(...n){const i=()=>{clearTimeout(s),t(...n)};clearTimeout(s),s=setTimeout(i,e)}}slugify(t){return t?t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""):""}}document.addEventListener("DOMContentLoaded",(()=>{new BlogSearch}));